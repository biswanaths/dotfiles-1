#!/usr/bin/env bash

# OS X specific config
if [ `uname` == "Darwin" ]; then
    echo "Installing OS X apps and configuring QuickLook..."
    if [[ -x /usr/local/bin/brew ]]; then
        brew install zsh && brew install vim --HEAD --with-perl --with-lua --override-system-vi
    else
        echo "Homebrew not installed. Installing it now..."
        ruby -e "$(curl -fsSL https://raw.github.com/Homebrew/homebrew/go/install)"
        brew install zsh && brew install vim --HEAD --with-perl --with-lua --override-system-vi
    fi
    defaults write com.apple.Finder QLEnableTextSelection -bool true
    # Slate
    echo "Setting up slate..."
    ln -s ~/dotfiles/.slate ~/.slate
fi

# Linux specific: Install apps
if [ `uname` == "Linux" ]; then
    cd ~/dotfiles && git checkout linux-branch
    echo "Installing apps"
    sudo apt-get install -y tmux zsh-dev build-essential mercurial \
    libncurses5-dev libgnome2-dev libgnomeui-dev \
    libgtk2.0-dev libatk1.0-dev libbonoboui2-dev \
    libcairo2-dev libx11-dev libxpm-dev libxt-dev python-dev ruby-dev
    cd ~/Downloads/
    echo "Downloading vim from source..."
    hg clone -r tip https://code.google.com/p/vim
    cd vim
    ./configure --with-features=huge \
            --enable-rubyinterp \
            --enable-pythoninterp \
            --with-python-config-dir=/usr/lib/python2.7-config \
            --enable-perlinterp \
            --enable-gui=gtk2 --enable-cscope --prefix=/usr
    make VIMRUNTIMEDIR=/usr/share/vim/vim74
    sudo make install
    cd ~
    echo "Installed vim!"
fi

# Symlink vim stuff
echo "Linking vim..."
ln -s ~/dotfiles/.vimrc ~/.vimrc
ln -s ~/dotfiles/.vim ~/.vim
echo "Cloning Vundle..."
rm -rf ~/.vim/bundle/ ; git clone https://github.com/gmarik/vundle.git ~/.vim/bundle/vundle
mkdir -p ~/.vim/backup/undo
vim +BundleInstall +qa
echo "Vim plugins installed!"

# Zsh
echo "Linking zsh"
ln -s ~/dotfiles/.zshrc ~/.zshrc
ln -s ~/dotfiles/.zsh ~/.zsh
rm -rf ~/.zsh/zsh-*
echo "Cloning zsh plugins..."
cd ~/.zsh && git clone https://github.com/zsh-users/zsh-history-substring-search.git
git clone git://github.com/zsh-users/zsh-syntax-highlighting.git

# Tmux
echo "Setting up tmux..."
ln -s ~/dotfiles/.tmux.conf ~/.tmux.conf

# Tig
echo "Setting up tig..."
ln -s ~/dotfiles/.tigrc ~/.tigrc

# Weechat
echo "Setting up weechat..."
ln -s ~/dotfiles/weechat ~/.weechat

# User scripts
echo "Linking user scripts..."
ln -s ~/dotfiles/bin ~/.bin

echo "Done!"
