#!/usr/bin/env bash
bold=`tput bold`
norm=`tput sgr0`

# Ask for user permission first
echo -e "\n${bold}This script will automatically install essential tools and"
echo "link files from this folder to $HOME."
echo "Do you wish to proceed?${norm}"
select yn in "Yes" "No"; do
case $yn in
    Yes ) echo "Proceeding with installation..." && break;;
    No ) echo "Fine. Exiting..." && exit;;
esac
done

# Install linux tools.
if [ `uname` == "Linux" ]; then
    if [ -f /etc/debian_version ]; then
        # Just so it doesn't try to run this on any other system.
        echo "${bold}Detected Debian-based system. Installing tools with apt-get...${norm}"
        sleep 2
        echo -e "\nGo get some coffee, this might take a while..."
        cd ~/dotfiles
        sudo apt-get install -y build-essential mercurial curl \
        xclip libncurses5-dev libgnome2-dev libgnomeui-dev docky suckless-tools \
        libgtk2.0-dev libatk1.0-dev libbonoboui2-dev gnome-terminal \
        libcairo2-dev libx11-dev libxpm-dev libxt-dev python-dev ruby-dev \
        autojump ruby texinfo libbz2-dev libcurl4-openssl-dev \
        libexpat-dev libncurses-dev zlib1g-dev rake
        cd ~/Downloads/

        # Set up tomorrow-night for gnome-terminal
        echo "${bold}Installing tomorrow-night colorscheme for gnome-terminal...${norm}"
        curl -O https://raw.githubusercontent.com/chriskempson/tomorrow-theme/master/Gnome-Terminal/setup-theme.sh
        chmod +x setup-theme.sh
        ./setup-theme.sh
        cd $HOME
    fi

    # Setup vim
    echo "${bold}Setting up vim...${norm}"
    /bin/ln -sfv ~/dotfiles/.vimrc $HOME
    /bin/ln -snfv ~/dotfiles/.vim $HOME
    mkdir -p ~/.vim/backup/undo
    if [ ! -d ~/.vim/bundle/ ]; then
        mkdir ~/.vim/bundle
    fi
    ~/dotfiles/.vimutil/install_bundles

    # Zsh
    echo "${bold}Linking zsh...${norm}"
    /bin/ln -sfv ~/dotfiles/.zshrc $HOME
    /bin/ln -sfv ~/dotfiles/.zshenv $HOME
    /bin/ln -snfv ~/dotfiles/.zsh $HOME

    # Tmux
    echo "${bold}Linking tmux...${norm}"
    /bin/ln -sfv ~/dotfiles/.tmux.conf $HOME

    # Git stuff
    echo "${bold}Linking tig...${norm}"
    /bin/ln -sfv ~/dotfiles/.tigrc $HOME
    echo "${bold}Linking git templates...${norm}"
    /bin/ln -snfv ~/dotfiles/.git_template $HOME

    # User scripts folder
    echo "${bold}Linking user scripts folder...${norm}"
    /bin/ln -snfv ~/dotfiles/.bin $HOME

    # Remap caps lock to control
    echo -e "\n${bold}Remapping caps lock to control${norm}"
    setxkbmap -option ctrl:nocaps

    echo -e "\n${bold}Done!${norm}"
fi
